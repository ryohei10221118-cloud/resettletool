<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seamless Tool ç»“ç®—åˆ†æå™¨</title>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide React Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { FileText, AlertCircle, CheckCircle, Copy, Trash2, Settings, Plus, Edit2, X } = lucide;

    const Icon = ({ icon: IconComponent, ...props }) => {
      const iconRef = React.useRef(null);

      React.useEffect(() => {
        if (iconRef.current && IconComponent) {
          lucide.createElement(IconComponent).render(iconRef.current);
        }
      }, [IconComponent]);

      return <i ref={iconRef} {...props}></i>;
    };

    const BettingSettlementAnalyzer = () => {
      // Random name placeholder
      const [namePlaceholder] = useState(() => {
        const names = ['Alex', 'Emma', 'Leo', 'Mia', 'Noah', 'Sophia', 'Oliver', 'Ava', 'Liam', 'Isabella'];
        return names[Math.floor(Math.random() * names.length)];
      });

      const [jsonData, setJsonData] = useState('');
      const [analysisType, setAnalysisType] = useState('resettlement');
      const [resettlementReasonTemplate, setResettlementReasonTemplate] = useState('');
      const [cancellationReasonTemplate, setCancellationReasonTemplate] = useState('');
      const [results, setResults] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [copyStatus, setCopyStatus] = useState('');
      const [showReasonManager, setShowReasonManager] = useState(false);
      const [editingReason, setEditingReason] = useState(null);
      const [newReason, setNewReason] = useState({ english: '', chinese: '', korean: '' });
      const [managingReasonType, setManagingReasonType] = useState('resettlement');
      const [deleteConfirmKey, setDeleteConfirmKey] = useState(null);
      const [showPerEventReasons, setShowPerEventReasons] = useState(false);
      const [perEventReasons, setPerEventReasons] = useState({});

      const [customResettlementReasons, setCustomResettlementReasons] = useState(() => {
        const stored = localStorage.getItem('customResettlementReasons');
        return stored ? JSON.parse(stored) : {};
      });

      const [customCancellationReasons, setCustomCancellationReasons] = useState(() => {
        const stored = localStorage.getItem('customCancellationReasons');
        return stored ? JSON.parse(stored) : {};
      });

      const [userName, setUserName] = useState(() => {
        const stored = localStorage.getItem('userName');
        return stored || '';
      });

      useEffect(() => {
        localStorage.setItem('customResettlementReasons', JSON.stringify(customResettlementReasons));
      }, [customResettlementReasons]);

      useEffect(() => {
        localStorage.setItem('customCancellationReasons', JSON.stringify(customCancellationReasons));
      }, [customCancellationReasons]);

      useEffect(() => {
        localStorage.setItem('userName', userName);
      }, [userName]);

      const capitalizeFirstLetter = (str) => {
        if (!str) return str;
        return str.charAt(0).toUpperCase() + str.slice(1);
      };

      const defaultResettlementReasons = {
        '': {
          english: 'Will provide after confirming',
          chinese: 'ç¡®è®¤åæä¾›',
          korean: 'í™•ì¸ í›„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤'
        },
        '_custom_fill': {
          english: '',
          chinese: '',
          korean: '',
        },
        'feed_provider': {
          english: 'Wrong info from feed',
          chinese: 'ä¾›åº”å•†èµ›æœæœ‰è¯¯',
          korean: 'ê³µê¸‰ì—…ì²´ ê²½ê¸° ê²°ê³¼ ì˜¤ë¥˜'
        },
        'system_error': {
          english: 'System error',
          chinese: 'ç³»ç»Ÿé”™è¯¯',
          korean: 'ì‹œìŠ¤í…œ ì˜¤ë¥˜'
        },
        'official_score': {
          english: 'Official score changed',
          chinese: 'å®˜æ–¹èµ›æœæ›´æ–°',
          korean: 'ê³µì‹ ê²½ê¸° ê²°ê³¼ ë³€ê²½ë¨'
        },
        'under_investigation': {
          english: 'Under investigation',
          chinese: 'è°ƒæŸ¥ä¸­',
          korean: 'ì¡°ì‚¬ ì¤‘'
        },
      };

      const resettlementReasonOptions = { ...defaultResettlementReasons, ...customResettlementReasons };

      const defaultCancellationReasons = {
        '': {
          english: 'Will provide after confirming',
          chinese: 'ç¡®è®¤åæä¾›',
          korean: 'í™•ì¸ í›„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤'
        },
        '_custom_fill': {
          english: '',
          chinese: '',
          korean: '',
        },
        'player_retired': {
          english: 'Player retired',
          chinese: 'é€‰æ‰‹é€€èµ›',
          korean: 'ê¸°ê¶Œ'
        },
        'postponed': {
          english: 'Postponed',
          chinese: 'å»¶æœŸ',
          korean: 'ì—°ê¸°'
        },
        'not_played': {
          english: 'Not played',
          chinese: 'èµ›äº‹æœªè¿›è¡Œ',
          korean: 'ê²½ê¸° ë¯¸ì‹¤ì‹œ'
        },
        'walkover': {
          english: 'Walkover',
          chinese: 'ä¸æˆ˜è€Œèƒœ',
          korean: 'ë¶€ì „ìŠ¹'
        },
      };

      const cancellationReasonOptions = { ...defaultCancellationReasons, ...customCancellationReasons };

      const parseXML = (xmlString) => {
        const parser = new DOMParser();
        return parser.parseFromString(xmlString, "text/xml");
      };

      const statusTranslations = {
        chinese: {
          'Won': 'èµ¢',
          'Lost': 'è¾“',
          'Canceled': 'å–æ¶ˆ',
          'Half Won': 'åŠèµ¢',
          'Half Lost': 'åŠè¾“',
          'Opened': 'æœªç»“ç®—',
          'Draw': 'å¹³å±€'
        },
        korean: {
          'Won': 'ìŠ¹ë¦¬',
          'Lost': 'íŒ¨',
          'Canceled': 'ì·¨ì†Œ',
          'Half Won': 'ë°˜ìŠ¹',
          'Half Lost': 'ë°˜íŒ¨',
          'Opened': 'ì§„í–‰ì¤‘ ë² íŒ…',
          'Draw': 'ë¬´ìŠ¹ë¶€'
        }
      };

      const translateStatus = (status, language) => {
        if (language === 'english') return status;
        return statusTranslations[language][status] || status;
      };

      const translateStatusHistory = (statusHistory, language) => {
        if (language === 'english') return statusHistory.join(' â†’ ');
        return statusHistory.map(status => translateStatus(status, language)).join(' â†’ ');
      };

      const formatDateTime = (dateTimeStr) => {
        if (!dateTimeStr) return '';

        let utcDateTimeStr = dateTimeStr;
        if (!dateTimeStr.includes('Z') && !dateTimeStr.includes('+') && !dateTimeStr.includes('-', 10)) {
          utcDateTimeStr = dateTimeStr + 'Z';
        }

        const date = new Date(utcDateTimeStr);
        const year = date.getUTCFullYear();
        const month = String(date.getUTCMonth() + 1).padStart(2, '0');
        const day = String(date.getUTCDate()).padStart(2, '0');
        const hours = String(date.getUTCHours()).padStart(2, '0');
        const minutes = String(date.getUTCMinutes()).padStart(2, '0');
        const seconds = String(date.getUTCSeconds()).padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds} (UTC+0)`;
      };

      const analyzeResettlements = (data) => {
        const lineIdTracking = new Map();
        const betStatusTracking = new Map();

        const settlementRecords = data.filter(item =>
          item.operationType === 'credit_customer' || item.operationType === 'debit_customer'
        ).sort((a, b) => new Date(a.creationdate) - new Date(b.creationdate));

        settlementRecords.forEach(record => {
          if (!record.reqparams) return;

          try {
            const xmlDoc = parseXML(record.reqparams);
            const selections = xmlDoc.getElementsByTagName('Selection');

            Array.from(selections).forEach(selection => {
              const changes = selection.getElementsByTagName('Change');
              Array.from(changes).forEach(change => {
                const bets = change.getElementsByTagName('Bet');
                if (bets.length > 0) {
                  const bet = bets[0];
                  const betId = bet.getAttribute('ID');
                  const betStatus = bet.getAttribute('NewStatus');
                  const dateUTC = change.getAttribute('DateUTC');

                  if (betId && betId !== '0' && betStatus && dateUTC) {
                    if (!betStatusTracking.has(betId)) {
                      betStatusTracking.set(betId, []);
                    }
                    betStatusTracking.get(betId).push({
                      status: betStatus,
                      dateUTC: dateUTC,
                      recordDate: record.creationdate
                    });
                  }
                }
              });
            });
          } catch (e) {
            console.error('XML parsing error:', e);
          }
        });

        settlementRecords.forEach(record => {
          if (!record.reqparams) return;

          try {
            const xmlDoc = parseXML(record.reqparams);
            const selections = xmlDoc.getElementsByTagName('Selection');

            Array.from(selections).forEach(selection => {
              const lineId = selection.getAttribute('LineID');
              const eventName = selection.getAttribute('EventName');

              if (!lineId || !eventName) return;

              const branchName = selection.getAttribute('BranchName') || '';
              const leagueName = selection.getAttribute('LeagueName') || '';
              const eventTypeName = selection.getAttribute('EventTypeName') || '';

              const changes = selection.getElementsByTagName('Change');
              Array.from(changes).forEach(change => {
                const oldStatus = change.getAttribute('OldStatus');
                const newStatus = change.getAttribute('NewStatus');
                const dateUTC = change.getAttribute('DateUTC');

                const bets = change.getElementsByTagName('Bet');
                let betId = '';
                if (bets.length > 0) {
                  betId = bets[0].getAttribute('ID');
                }

                if (!lineIdTracking.has(lineId)) {
                  lineIdTracking.set(lineId, {
                    eventName,
                    branchName,
                    leagueName,
                    eventTypeName,
                    statusHistory: [],
                    betId: betId !== '0' ? betId : ''
                  });
                }

                const tracking = lineIdTracking.get(lineId);
                tracking.statusHistory.push({
                  oldStatus,
                  newStatus,
                  dateUTC,
                  recordDate: record.creationdate
                });

                if (betId !== '0' && !tracking.betId) {
                  tracking.betId = betId;
                }
              });
            });
          } catch (e) {
            console.error('XML parsing error:', e);
          }
        });

        // Count total unique LineIDs per betId to detect multi-event bets
        const betEventCount = new Map();
        lineIdTracking.forEach((tracking) => {
          if (tracking.betId) {
            if (!betEventCount.has(tracking.betId)) {
              betEventCount.set(tracking.betId, 0);
            }
            betEventCount.set(tracking.betId, betEventCount.get(tracking.betId) + 1);
          }
        });

        const resettlements = [];
        lineIdTracking.forEach((tracking, lineId) => {
          if (tracking.statusHistory.length > 1) {
            tracking.statusHistory.sort((a, b) => new Date(a.dateUTC) - new Date(b.dateUTC));

            const statusChanges = tracking.statusHistory.map(h => h.newStatus);
            const uniqueStatuses = [...new Set(statusChanges)];

            if (uniqueStatuses.length > 1) {
              let finalBetStatus = 'N/A';
              if (tracking.betId && betStatusTracking.has(tracking.betId)) {
                const betStatuses = betStatusTracking.get(tracking.betId);
                betStatuses.sort((a, b) => new Date(a.dateUTC) - new Date(b.dateUTC));
                if (betStatuses.length > 0) {
                  finalBetStatus = betStatuses[betStatuses.length - 1].status;
                }
              }

              resettlements.push({
                betId: tracking.betId || 'N/A',
                eventName: tracking.eventName,
                sport: tracking.branchName,
                league: tracking.leagueName,
                market: tracking.eventTypeName,
                statusHistory: statusChanges,
                betStatus: finalBetStatus,
                firstSettlementTime: tracking.statusHistory[0].dateUTC,
                lastUpdateTime: tracking.statusHistory[tracking.statusHistory.length - 1].dateUTC,
                totalEventsInBet: tracking.betId ? (betEventCount.get(tracking.betId) || 1) : 1
              });
            }
          }
        });

        return resettlements;
      };

      const analyzeCancellations = (data) => {
        const lineIdTracking = new Map();
        const betStatusTracking = new Map();

        const settlementRecords = data.filter(item =>
          item.operationType === 'credit_customer' || item.operationType === 'debit_customer'
        ).sort((a, b) => new Date(a.creationdate) - new Date(b.creationdate));

        settlementRecords.forEach(record => {
          if (!record.reqparams) return;

          try {
            const xmlDoc = parseXML(record.reqparams);
            const selections = xmlDoc.getElementsByTagName('Selection');

            Array.from(selections).forEach(selection => {
              const changes = selection.getElementsByTagName('Change');
              Array.from(changes).forEach(change => {
                const bets = change.getElementsByTagName('Bet');
                if (bets.length > 0) {
                  const bet = bets[0];
                  const betId = bet.getAttribute('ID');
                  const betStatus = bet.getAttribute('NewStatus');
                  const dateUTC = change.getAttribute('DateUTC');

                  if (betId && betId !== '0' && betStatus && dateUTC) {
                    if (!betStatusTracking.has(betId)) {
                      betStatusTracking.set(betId, []);
                    }
                    betStatusTracking.get(betId).push({
                      status: betStatus,
                      dateUTC: dateUTC,
                      recordDate: record.creationdate
                    });
                  }
                }
              });
            });
          } catch (e) {
            console.error('XML parsing error:', e);
          }
        });

        settlementRecords.forEach(record => {
          if (!record.reqparams) return;

          try {
            const xmlDoc = parseXML(record.reqparams);
            const selections = xmlDoc.getElementsByTagName('Selection');

            Array.from(selections).forEach(selection => {
              const lineId = selection.getAttribute('LineID');
              const eventName = selection.getAttribute('EventName');

              if (!lineId || !eventName) return;

              const changes = selection.getElementsByTagName('Change');
              Array.from(changes).forEach(change => {
                const newStatus = change.getAttribute('NewStatus');
                const dateUTC = change.getAttribute('DateUTC');

                const bets = change.getElementsByTagName('Bet');
                let betId = '';
                if (bets.length > 0) {
                  betId = bets[0].getAttribute('ID');
                }

                if (!lineIdTracking.has(lineId)) {
                  lineIdTracking.set(lineId, {
                    eventName,
                    statusHistory: [],
                    betId: betId !== '0' ? betId : ''
                  });
                }

                const tracking = lineIdTracking.get(lineId);
                tracking.statusHistory.push({
                  newStatus,
                  dateUTC,
                  recordDate: record.creationdate
                });

                if (betId !== '0' && !tracking.betId) {
                  tracking.betId = betId;
                }
              });
            });
          } catch (e) {
            console.error('XML parsing error:', e);
          }
        });

        // Count total unique LineIDs per betId to detect multi-event bets
        const betEventCount = new Map();
        lineIdTracking.forEach((tracking) => {
          if (tracking.betId) {
            if (!betEventCount.has(tracking.betId)) {
              betEventCount.set(tracking.betId, 0);
            }
            betEventCount.set(tracking.betId, betEventCount.get(tracking.betId) + 1);
          }
        });

        const cancellations = [];
        lineIdTracking.forEach((tracking, lineId) => {
          if (tracking.statusHistory.length > 0) {
            tracking.statusHistory.sort((a, b) => new Date(a.dateUTC) - new Date(b.dateUTC));
            const lastStatus = tracking.statusHistory[tracking.statusHistory.length - 1];

            if (lastStatus.newStatus === 'Canceled') {
              let finalBetStatus = 'N/A';
              if (tracking.betId && betStatusTracking.has(tracking.betId)) {
                const betStatuses = betStatusTracking.get(tracking.betId);
                betStatuses.sort((a, b) => new Date(a.dateUTC) - new Date(b.dateUTC));
                if (betStatuses.length > 0) {
                  finalBetStatus = betStatuses[betStatuses.length - 1].status;
                }
              }

              cancellations.push({
                betId: tracking.betId || 'N/A',
                eventName: tracking.eventName,
                eventStatus: 'Canceled',
                betStatus: finalBetStatus,
                updateTime: lastStatus.dateUTC,
                totalEventsInBet: tracking.betId ? (betEventCount.get(tracking.betId) || 1) : 1
              });
            }
          }
        });

        return cancellations;
      };

      const generateResettlementReports = (resettlements, customReasons = null) => {
        if (resettlements.length === 0) {
          return {
            english: 'No resettlement records.',
            chinese: 'æ— é‡æ–°ç»“ç®—è®°å½•ã€‚',
            korean: 'ë¬´ ì¬ì •ì‚° ê¸°ë¡.'
          };
        }

        const defaultReasonText = resettlementReasonOptions[resettlementReasonTemplate];
        const nameSuffix = userName ? ` - ${userName}` : '';

        const isMultiEventBet = resettlements.some(item => item.totalEventsInBet > 1);
        const enSubject = isMultiEventBet
          ? (resettlements.length > 1 ? 'The selections have' : 'The selection has')
          : 'The bet has';
        const cnSubject = isMultiEventBet ? 'çº¿æ³¨' : 'æ³¨å•';
        const krSubject = isMultiEventBet ? 'ë¼ì¸' : 'ë² íŒ…';
        let englishReport = `Thank you for waiting. ${enSubject} been resettled but BO needs 5-10 mins to be updated. Please check again then. Thank you.${nameSuffix}\n\n`;
        let chineseReport = `${cnSubject}å·²é‡æ–°ç»“ç®—ï¼Œåå°æ›´æ–°éœ€è¦5-10åˆ†é’Ÿï¼Œçƒ¦è¯·è´µå¸ç¨ç­‰åˆ·æ–°æŸ¥çœ‹ï¼Œè°¢è°¢ã€‚${nameSuffix}\n\n`;
        let koreanReport = `ê¸°ë‹¤ë ¤ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ${krSubject}ì´ ì¬ì •ì‚°ë˜ì—ˆì§€ë§Œ BOê°€ ì—…ë°ì´íŠ¸ë˜ëŠ” ë° 5-10ë¶„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤. ê·¸ í›„ì— ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.${nameSuffix}\n\n`;

        // Event-only reports (without quick reply intro)
        let englishEventOnly = '';
        let chineseEventOnly = '';
        let koreanEventOnly = '';

        resettlements.forEach((item, index) => {
          const statusHistoryEN = translateStatusHistory(item.statusHistory, 'english');
          const statusHistoryCN = translateStatusHistory(item.statusHistory, 'chinese');
          const statusHistoryKR = translateStatusHistory(item.statusHistory, 'korean');

          // Use custom reason for this event if provided, otherwise use default
          const reasonKey = customReasons && customReasons[index] !== undefined ? customReasons[index] : resettlementReasonTemplate;
          const reasonText = resettlementReasonOptions[reasonKey];

          const eventFieldEN = resettlements.length > 1 ? `Event${index + 1}` : 'Event';
          const eventFieldCN = resettlements.length > 1 ? `èµ›äº‹${index + 1}` : 'èµ›äº‹';
          const eventFieldKR = resettlements.length > 1 ? `ì´ë²¤íŠ¸${index + 1}` : 'ì´ë²¤íŠ¸';

          const enBlock = `Bet ID: ${item.betId}\n${eventFieldEN}: ${item.eventName}\nEvent Resettlement History: ${statusHistoryEN}\nBet Status: ${item.betStatus}\nFirst Settlement Time: ${formatDateTime(item.firstSettlementTime)}\nLast Update Time: ${formatDateTime(item.lastUpdateTime)}\nReason for Resettlement: ${reasonText.english}`;
          const cnBlock = `æ³¨å•å·ï¼š${item.betId}\n${eventFieldCN}ï¼š${item.eventName}\nèµ›äº‹é‡æ–°ç»“ç®—å†å²ï¼š${statusHistoryCN}\næ³¨å•çŠ¶æ€ï¼š${translateStatus(item.betStatus, 'chinese')}\nç¬¬ä¸€æ¬¡ç»“ç®—æ—¶é—´ï¼š${formatDateTime(item.firstSettlementTime)}\næœ€åæ›´æ–°æ—¶é—´ï¼š${formatDateTime(item.lastUpdateTime)}\né‡æ–°ç»“ç®—åŸå› ï¼š${reasonText.chinese}`;
          const krBlock = `ë² íŒ… ë²ˆí˜¸: ${item.betId}\n${eventFieldKR}: ${item.eventName}\nê²½ê¸° ì¬ì •ì‚° ë‚´ì—­: ${statusHistoryKR}\në² íŒ… ìƒíƒœ: ${translateStatus(item.betStatus, 'korean')}\nì²« ë²ˆì§¸ ì •ì‚° ì‹œê°„: ${formatDateTime(item.firstSettlementTime)}\në§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„: ${formatDateTime(item.lastUpdateTime)}\nì¬ì •ì‚° ì‚¬ìœ : ${reasonText.korean}`;

          englishReport += enBlock;
          chineseReport += cnBlock;
          koreanReport += krBlock;
          englishEventOnly += enBlock;
          chineseEventOnly += cnBlock;
          koreanEventOnly += krBlock;

          if (index < resettlements.length - 1) {
            englishReport += '\n\n';
            chineseReport += '\n\n';
            koreanReport += '\n\n';
            englishEventOnly += '\n\n';
            chineseEventOnly += '\n\n';
            koreanEventOnly += '\n\n';
          }
        });

        return {
          english: englishReport,
          chinese: chineseReport,
          korean: koreanReport,
          englishEventOnly,
          chineseEventOnly,
          koreanEventOnly
        };
      };

      const generateCancellationReports = (cancellations, customReasons = null) => {
        if (cancellations.length === 0) {
          return {
            english: 'No cancellation records.',
            chinese: 'æ— å–æ¶ˆè®°å½•ã€‚',
            korean: 'ë¬´ ì·¨ì†Œ ê¸°ë¡.'
          };
        }

        const defaultReasonText = cancellationReasonOptions[cancellationReasonTemplate];
        const nameSuffix = userName ? ` - ${userName}` : '';

        const isMultiEventBet = cancellations.some(item => item.totalEventsInBet > 1);
        const enSubject = isMultiEventBet
          ? (cancellations.length > 1 ? 'The selections have' : 'The selection has')
          : 'The bet has';
        const cnSubject = isMultiEventBet ? 'çº¿æ³¨' : 'æ³¨å•';
        const krSubject = isMultiEventBet ? 'ë¼ì¸' : 'ë² íŒ…';
        let englishReport = `Thank you for waiting. ${enSubject} been canceled but BO needs 5-10 mins to be updated. Please check again then. Thank you.${nameSuffix}\n\n`;
        let chineseReport = `${cnSubject}å·²å–æ¶ˆï¼Œåå°æ›´æ–°éœ€è¦5-10åˆ†é’Ÿï¼Œçƒ¦è¯·è´µå¸ç¨ç­‰åˆ·æ–°æŸ¥çœ‹ï¼Œè°¢è°¢ã€‚${nameSuffix}\n\n`;
        let koreanReport = `ê¸°ë‹¤ë ¤ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ${krSubject}ì´ ì·¨ì†Œë˜ì—ˆì§€ë§Œ BOê°€ ì—…ë°ì´íŠ¸ë˜ëŠ” ë° 5-10ë¶„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤. ê·¸ í›„ì— ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.${nameSuffix}\n\n`;

        // Event-only reports (without quick reply intro)
        let englishEventOnly = '';
        let chineseEventOnly = '';
        let koreanEventOnly = '';

        cancellations.forEach((item, index) => {
          // Use custom reason for this event if provided, otherwise use default
          const reasonKey = customReasons && customReasons[index] !== undefined ? customReasons[index] : cancellationReasonTemplate;
          const reasonText = cancellationReasonOptions[reasonKey];

          const eventFieldEN = cancellations.length > 1 ? `Event${index + 1}` : 'Event';
          const eventFieldCN = cancellations.length > 1 ? `èµ›äº‹${index + 1}` : 'èµ›äº‹';
          const eventFieldKR = cancellations.length > 1 ? `ì´ë²¤íŠ¸${index + 1}` : 'ì´ë²¤íŠ¸';

          const enBlock = `Bet ID: ${item.betId}\n${eventFieldEN}: ${item.eventName}\nEvent Status: ${item.eventStatus}\nBet Status: ${item.betStatus}\nUpdate Time: ${formatDateTime(item.updateTime)}\nReason of Cancelation: ${reasonText.english}`;
          const cnBlock = `æ³¨å•å·ï¼š${item.betId}\n${eventFieldCN}ï¼š${item.eventName}\nèµ›äº‹çŠ¶æ€ï¼š${translateStatus(item.eventStatus, 'chinese')}\næ³¨å•çŠ¶æ€ï¼š${translateStatus(item.betStatus, 'chinese')}\næ›´æ–°æ—¶é—´ï¼š${formatDateTime(item.updateTime)}\nå–æ¶ˆåŸå› ï¼š${reasonText.chinese}`;
          const krBlock = `ë² íŒ… ID: ${item.betId}\n${eventFieldKR}: ${item.eventName}\nì´ë²¤íŠ¸ ìƒíƒœ: ${translateStatus(item.eventStatus, 'korean')}\në² íŒ… ìƒíƒœ: ${translateStatus(item.betStatus, 'korean')}\nì—…ë°ì´íŠ¸ ì‹œê°„: ${formatDateTime(item.updateTime)}\nì·¨ì†Œ ì‚¬ìœ : ${reasonText.korean}`;

          englishReport += enBlock;
          chineseReport += cnBlock;
          koreanReport += krBlock;
          englishEventOnly += enBlock;
          chineseEventOnly += cnBlock;
          koreanEventOnly += krBlock;

          if (index < cancellations.length - 1) {
            englishReport += '\n\n';
            chineseReport += '\n\n';
            koreanReport += '\n\n';
            englishEventOnly += '\n\n';
            chineseEventOnly += '\n\n';
            koreanEventOnly += '\n\n';
          }
        });

        return {
          english: englishReport,
          chinese: chineseReport,
          korean: koreanReport,
          englishEventOnly,
          chineseEventOnly,
          koreanEventOnly
        };
      };

      const handleAnalyze = () => {
        if (!jsonData.trim()) {
          setError('è¯·è¾“å…¥JSONæ•°æ®');
          return;
        }

        setLoading(true);
        setError('');
        setShowPerEventReasons(false);
        setPerEventReasons({});

        try {
          const data = JSON.parse(jsonData);

          if (!Array.isArray(data)) {
            throw new Error('è¯·è¾“å…¥JSONæ•°ç»„æ ¼å¼çš„Seamless toolæ•°æ®');
          }

          let reports = {};
          let analyzedData = [];

          if (analysisType === 'resettlement') {
            analyzedData = analyzeResettlements(data);
            reports = generateResettlementReports(analyzedData);
          } else {
            analyzedData = analyzeCancellations(data);
            reports = generateCancellationReports(analyzedData);
          }

          // Store analyzed data and event count for per-event editing
          reports.analyzedData = analyzedData;
          reports.eventCount = analyzedData.length;

          setResults(reports);
        } catch (e) {
          setError('æ•°æ®è§£æé”™è¯¯: ' + e.message);
        } finally {
          setLoading(false);
        }
      };

      const handleRegenerateWithCustomReasons = () => {
        if (!results || !results.analyzedData) return;

        const customReasonsArray = {};
        Object.keys(perEventReasons).forEach(index => {
          customReasonsArray[parseInt(index)] = perEventReasons[index];
        });

        let reports = {};
        if (analysisType === 'resettlement') {
          reports = generateResettlementReports(results.analyzedData, customReasonsArray);
        } else {
          reports = generateCancellationReports(results.analyzedData, customReasonsArray);
        }

        // Preserve analyzed data
        reports.analyzedData = results.analyzedData;
        reports.eventCount = results.eventCount;

        setResults(reports);
        setCopyStatus('æŠ¥å‘Šå·²é‡æ–°ç”Ÿæˆ');
        setTimeout(() => setCopyStatus(''), 2000);
      };

      const handleCopy = (language) => {
        if (!results || !results[language]) return;

        try {
          const textArea = document.createElement('textarea');
          textArea.value = results[language].replace(/[\r\n]+$/, '');
          textArea.style.position = 'fixed';
          textArea.style.left = '-999999px';
          textArea.style.top = '-999999px';
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();

          const successful = document.execCommand('copy');
          document.body.removeChild(textArea);

          if (successful) {
            setCopyStatus(`å·²å¤åˆ¶${language === 'english' ? 'è‹±æ–‡' : language === 'chinese' ? 'ä¸­æ–‡' : 'éŸ©æ–‡'}å†…å®¹`);
            setTimeout(() => setCopyStatus(''), 2000);
          } else {
            setCopyStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            setTimeout(() => setCopyStatus(''), 3000);
          }
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          setCopyStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
          setTimeout(() => setCopyStatus(''), 3000);
        }
      };

      const handleCopyEventOnly = (language) => {
        const key = language + 'EventOnly';
        if (!results || !results[key]) return;

        try {
          const textArea = document.createElement('textarea');
          textArea.value = results[key].replace(/[\r\n]+$/, '');
          textArea.style.position = 'fixed';
          textArea.style.left = '-999999px';
          textArea.style.top = '-999999px';
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();

          const successful = document.execCommand('copy');
          document.body.removeChild(textArea);

          if (successful) {
            setCopyStatus(`å·²å¤åˆ¶${language === 'english' ? 'è‹±æ–‡' : language === 'chinese' ? 'ä¸­æ–‡' : 'éŸ©æ–‡'}èµ›äº‹ä¿¡æ¯ï¼ˆä¸å«å¿«é€Ÿå›å¤ï¼‰`);
            setTimeout(() => setCopyStatus(''), 2000);
          } else {
            setCopyStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            setTimeout(() => setCopyStatus(''), 3000);
          }
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          setCopyStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
          setTimeout(() => setCopyStatus(''), 3000);
        }
      };

      const handleCopyTableData = () => {
        if (!results || !results.analyzedData) return;

        const reasonOptions = analysisType === 'resettlement' ? resettlementReasonOptions : cancellationReasonOptions;
        const defaultReasonKey = analysisType === 'resettlement' ? resettlementReasonTemplate : cancellationReasonTemplate;

        const rows = results.analyzedData.map((item, index) => {
          const reasonKey = perEventReasons[index] !== undefined ? perEventReasons[index] : defaultReasonKey;
          const reasonText = reasonOptions[reasonKey]?.english || '';
          const date = item.firstSettlementTime ? item.firstSettlementTime.split('T')[0] : '';

          return [
            '',
            item.betId || '',
            '',
            item.sport || '',
            item.league || '',
            item.eventName || '',
            item.market || '',
            userName
          ].join('\t');
        });

        const tableData = rows.join('\n');

        try {
          const textArea = document.createElement('textarea');
          textArea.value = tableData;
          textArea.style.position = 'fixed';
          textArea.style.left = '-999999px';
          textArea.style.top = '-999999px';
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();

          const successful = document.execCommand('copy');
          document.body.removeChild(textArea);

          if (successful) {
            setCopyStatus(`å·²å¤åˆ¶ ${rows.length} ç¬”è¡¨æ ¼æ•°æ®ï¼ˆå¯ç›´æ¥è´´å…¥Excel/Google Sheetsï¼‰`);
            setTimeout(() => setCopyStatus(''), 2000);
          } else {
            setCopyStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            setTimeout(() => setCopyStatus(''), 3000);
          }
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          setCopyStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
          setTimeout(() => setCopyStatus(''), 3000);
        }
      };

      const handleAddReason = () => {
        if (!newReason.english || !newReason.chinese || !newReason.korean) {
          alert('è¯·å¡«å†™å®Œæ•´çš„åŸå› ä¿¡æ¯');
          return;
        }

        const timestamp = Date.now();
        const key = `custom_${timestamp}`;

        if (managingReasonType === 'resettlement') {
          setCustomResettlementReasons({
            ...customResettlementReasons,
            [key]: {
              english: capitalizeFirstLetter(newReason.english),
              chinese: newReason.chinese,
              korean: newReason.korean
            }
          });
        } else {
          setCustomCancellationReasons({
            ...customCancellationReasons,
            [key]: {
              english: capitalizeFirstLetter(newReason.english),
              chinese: newReason.chinese,
              korean: newReason.korean
            }
          });
        }

        setNewReason({ english: '', chinese: '', korean: '' });
      };

      const handleEditReason = (key) => {
        const reasons = managingReasonType === 'resettlement' ? customResettlementReasons : customCancellationReasons;
        setEditingReason({ key, ...reasons[key] });
      };

      const handleSaveEdit = () => {
        if (!editingReason.english || !editingReason.chinese || !editingReason.korean) {
          alert('è¯·å¡«å†™å®Œæ•´çš„åŸå› ä¿¡æ¯');
          return;
        }

        if (managingReasonType === 'resettlement') {
          setCustomResettlementReasons({
            ...customResettlementReasons,
            [editingReason.key]: {
              english: capitalizeFirstLetter(editingReason.english),
              chinese: editingReason.chinese,
              korean: editingReason.korean
            }
          });
        } else {
          setCustomCancellationReasons({
            ...customCancellationReasons,
            [editingReason.key]: {
              english: capitalizeFirstLetter(editingReason.english),
              chinese: editingReason.chinese,
              korean: editingReason.korean
            }
          });
        }

        setEditingReason(null);
      };

      const handleDeleteReason = (key) => {
        if (managingReasonType === 'resettlement') {
          const updated = { ...customResettlementReasons };
          delete updated[key];
          setCustomResettlementReasons(updated);
        } else {
          const updated = { ...customCancellationReasons };
          delete updated[key];
          setCustomCancellationReasons(updated);
        }
        setDeleteConfirmKey(null);
      };

      const handleClear = () => {
        setJsonData('');
        setResettlementReasonTemplate('');
        setCancellationReasonTemplate('');
        setResults(null);
        setError('');
        setCopyStatus('');
      };

      const modalContainerStyle = {
        overflow: 'hidden'
      };

      const modalBoxStyle = {
        height: '600px',
        maxHeight: '85vh',
        display: 'flex',
        flexDirection: 'column',
        overflow: 'hidden'
      };

      const modalHeaderStyle = {
        flexShrink: 0
      };

      const modalContentStyle = {
        flex: 1,
        overflowY: 'auto',
        overflowX: 'hidden'
      };

      return (
        <div className="max-w-6xl mx-auto p-6 bg-white">
          <div className="mb-8 flex items-center justify-between">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 mb-2">Seamless Tool ç»“ç®—åˆ†æå™¨</h1>
              <p className="text-gray-600">ä¸“ä¸ºSeamless toolå¹³å°è®¾è®¡çš„æŠ•æ³¨ç»“ç®—Logåˆ†æå·¥å…·</p>
            </div>
            <button
              onClick={() => setShowReasonManager(true)}
              className="bg-gray-100 hover:bg-gray-200 text-2xl p-3 rounded-lg transition-colors"
              title="ç®¡ç†è‡ªå®šä¹‰åŸå› "
            >
              âš™ï¸
            </button>
          </div>

          {showReasonManager && (
            <div
              className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
              style={modalContainerStyle}
            >
              <div
                className="bg-white rounded-lg shadow-2xl w-full max-w-2xl"
                style={modalBoxStyle}
              >
                <div
                  className="border-b border-gray-200 p-4 bg-white rounded-t-lg"
                  style={modalHeaderStyle}
                >
                  <div className="flex items-center justify-between">
                    <h2 className="text-xl font-semibold flex items-center">
                      <span className="mr-2">âš™ï¸</span>
                      ç®¡ç†è‡ªå®šä¹‰åŸå› 
                    </h2>
                    <button
                      onClick={() => {
                        setShowReasonManager(false);
                        setEditingReason(null);
                        setNewReason({ english: '', chinese: '', korean: '' });
                        setDeleteConfirmKey(null);
                      }}
                      className="text-gray-500 hover:text-gray-700 text-2xl"
                    >
                      âœ•
                    </button>
                  </div>
                </div>

                <div className="p-6" style={modalContentStyle}>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        åŸå› ç±»å‹
                      </label>
                      <select
                        value={managingReasonType}
                        onChange={(e) => {
                          setManagingReasonType(e.target.value);
                          setEditingReason(null);
                          setNewReason({ english: '', chinese: '', korean: '' });
                          setDeleteConfirmKey(null);
                        }}
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="resettlement">é‡æ–°ç»“ç®—åŸå› </option>
                        <option value="cancellation">å–æ¶ˆåŸå› </option>
                      </select>
                    </div>

                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                      <div className="text-sm font-semibold text-gray-700 mb-3">â• æ·»åŠ æ–°åŸå› </div>
                      <div className="space-y-3">
                        <input
                          type="text"
                          placeholder="è‹±æ–‡åŸå› "
                          value={newReason.english}
                          onChange={(e) => setNewReason({ ...newReason, english: e.target.value })}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <input
                          type="text"
                          placeholder="ä¸­æ–‡åŸå› "
                          value={newReason.chinese}
                          onChange={(e) => setNewReason({ ...newReason, chinese: e.target.value })}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <input
                          type="text"
                          placeholder="éŸ©æ–‡åŸå› "
                          value={newReason.korean}
                          onChange={(e) => setNewReason({ ...newReason, korean: e.target.value })}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <button
                          onClick={handleAddReason}
                          className="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 flex items-center justify-center"
                        >
                          <span className="mr-2">â•</span>
                          æ·»åŠ å¹¶ä¿å­˜
                        </button>
                      </div>
                    </div>

                    <div>
                      <div className="text-sm font-semibold text-gray-700 mb-3">ğŸ“‹ è‡ªå®šä¹‰åŸå› åˆ—è¡¨</div>
                      {Object.keys(managingReasonType === 'resettlement' ? customResettlementReasons : customCancellationReasons).length === 0 ? (
                        <div className="text-center text-gray-500 italic py-8 bg-gray-50 rounded-lg">
                          æš‚æ— è‡ªå®šä¹‰åŸå› 
                        </div>
                      ) : (
                        <div className="space-y-3">
                          {Object.keys(managingReasonType === 'resettlement' ? customResettlementReasons : customCancellationReasons).map(key => {
                            const reason = managingReasonType === 'resettlement' ? customResettlementReasons[key] : customCancellationReasons[key];
                            const isEditing = editingReason && editingReason.key === key;

                            return (
                              <div key={key} className="bg-white border border-gray-300 rounded-lg p-4">
                                {isEditing ? (
                                  <div className="space-y-3">
                                    <div className="text-sm font-medium text-gray-600 mb-2">ç¼–è¾‘åŸå› </div>
                                    <input
                                      type="text"
                                      value={editingReason.english}
                                      onChange={(e) => setEditingReason({ ...editingReason, english: e.target.value })}
                                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="è‹±æ–‡"
                                    />
                                    <input
                                      type="text"
                                      value={editingReason.chinese}
                                      onChange={(e) => setEditingReason({ ...editingReason, chinese: e.target.value })}
                                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="ä¸­æ–‡"
                                    />
                                    <input
                                      type="text"
                                      value={editingReason.korean}
                                      onChange={(e) => setEditingReason({ ...editingReason, korean: e.target.value })}
                                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="éŸ©æ–‡"
                                    />
                                    <div className="flex gap-2">
                                      <button
                                        onClick={handleSaveEdit}
                                        className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700"
                                      >
                                        ä¿å­˜
                                      </button>
                                      <button
                                        onClick={() => setEditingReason(null)}
                                        className="flex-1 bg-gray-400 text-white py-2 px-4 rounded-md hover:bg-gray-500"
                                      >
                                        å–æ¶ˆ
                                      </button>
                                    </div>
                                  </div>
                                ) : (
                                  <div>
                                    <div className="space-y-1 mb-3">
                                      <div className="text-sm"><span className="font-medium">EN:</span> {reason.english}</div>
                                      <div className="text-sm"><span className="font-medium">CN:</span> {reason.chinese}</div>
                                      <div className="text-sm"><span className="font-medium">KR:</span> {reason.korean}</div>
                                    </div>
                                    {deleteConfirmKey === key ? (
                                      <div className="space-y-2">
                                        <div className="text-sm text-red-600 font-medium">ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ</div>
                                        <div className="flex gap-2">
                                          <button
                                            onClick={() => handleDeleteReason(key)}
                                            className="flex-1 bg-red-600 text-white py-2 px-3 rounded-md hover:bg-red-700 flex items-center justify-center"
                                          >
                                            <span className="mr-1">âœ•</span>
                                            ç¡®è®¤åˆ é™¤
                                          </button>
                                          <button
                                            onClick={() => setDeleteConfirmKey(null)}
                                            className="flex-1 bg-gray-400 text-white py-2 px-3 rounded-md hover:bg-gray-500"
                                          >
                                            å–æ¶ˆ
                                          </button>
                                        </div>
                                      </div>
                                    ) : (
                                      <div className="flex gap-2">
                                        <button
                                          onClick={() => handleEditReason(key)}
                                          className="flex-1 bg-blue-500 text-white py-2 px-3 rounded-md hover:bg-blue-600 flex items-center justify-center"
                                        >
                                          <span className="mr-1">âœï¸</span>
                                          ç¼–è¾‘
                                        </button>
                                        <button
                                          onClick={() => setDeleteConfirmKey(key)}
                                          className="flex-1 bg-red-500 text-white py-2 px-3 rounded-md hover:bg-red-600 flex items-center justify-center"
                                        >
                                          <span className="mr-1">âœ•</span>
                                          åˆ é™¤
                                        </button>
                                      </div>
                                    )}
                                  </div>
                                )}
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="space-y-6">
              <div className="bg-gray-50 p-6 rounded-lg">
                <h2 className="text-xl font-semibold mb-4 flex items-center">
                  <span className="mr-2">ğŸ“„</span>
                  åˆ†æè®¾ç½®
                </h2>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      åˆ†æç±»å‹
                    </label>
                    <select
                      value={analysisType}
                      onChange={(e) => setAnalysisType(e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="resettlement">é‡æ–°ç»“ç®—è®°å½•</option>
                      <option value="cancellation">å–æ¶ˆè®°å½•</option>
                    </select>
                  </div>

                  {analysisType === 'resettlement' && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        é‡æ–°ç»“ç®—åŸå› 
                      </label>
                      <select
                        value={resettlementReasonTemplate}
                        onChange={(e) => setResettlementReasonTemplate(e.target.value)}
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="">Will provide after confirming - ç¡®è®¤åæä¾› - í™•ì¸ í›„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤ (é¢„è®¾)</option>
                        <option value="_custom_fill">âœï¸ è‡ªè¡Œå¡«å†™ (ç•™ç©º)</option>
                        {Object.keys(resettlementReasonOptions).filter(k => k !== '' && k !== '_custom_fill').map(key => {
                          const reason = resettlementReasonOptions[key];
                          const isCustom = !defaultResettlementReasons[key];
                          return (
                            <option key={key} value={key}>
                              {isCustom && 'â­ '}{reason.english} - {reason.chinese} - {reason.korean}
                            </option>
                          );
                        })}
                      </select>
                    </div>
                  )}

                  {analysisType === 'cancellation' && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        å–æ¶ˆåŸå› 
                      </label>
                      <select
                        value={cancellationReasonTemplate}
                        onChange={(e) => setCancellationReasonTemplate(e.target.value)}
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="">Will provide after confirming - ç¡®è®¤åæä¾› - í™•ì¸ í›„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤ (é¢„è®¾)</option>
                        <option value="_custom_fill">âœï¸ è‡ªè¡Œå¡«å†™ (ç•™ç©º)</option>
                        {Object.keys(cancellationReasonOptions).filter(k => k !== '' && k !== '_custom_fill').map(key => {
                          const reason = cancellationReasonOptions[key];
                          const isCustom = !defaultCancellationReasons[key];
                          return (
                            <option key={key} value={key}>
                              {isCustom && 'â­ '}{reason.english} - {reason.chinese} - {reason.korean}
                            </option>
                          );
                        })}
                      </select>
                    </div>
                  )}

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ğŸ‘¤ ç»‘å®šåå­—
                    </label>
                    <input
                      type="text"
                      placeholder={`ä¾‹å¦‚: ${namePlaceholder} ï¼ˆåå­—ä¼šæ˜¾ç¤ºåœ¨å¿«é€Ÿå›å¤åé¢ï¼‰`}
                      value={userName}
                      onChange={(e) => setUserName(e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    {userName && (
                      <div className="mt-2 text-xs text-gray-600 bg-blue-50 p-2 rounded">
                        ç¤ºä¾‹: Thank you for waiting... - <span className="font-semibold">{userName}</span>
                      </div>
                    )}
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      JSONæ•°æ®è¾“å…¥
                    </label>
                    <textarea
                      value={jsonData}
                      onChange={(e) => setJsonData(e.target.value)}
                      placeholder="è¯·ç²˜è´´å®Œæ•´çš„Seamless tool JSONæ•°ç»„æ•°æ®..."
                      className="w-full h-64 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                    />
                  </div>

                  <div className="flex gap-3">
                    <button
                      onClick={handleAnalyze}
                      disabled={loading}
                      className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                    >
                      {loading ? (
                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                      ) : null}
                      {loading ? 'åˆ†æä¸­...' : 'å¼€å§‹åˆ†æ'}
                    </button>

                    <button
                      onClick={handleClear}
                      className="bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 flex items-center"
                    >
                      <span className="mr-1">ğŸ—‘ï¸</span>
                      ä¸€é”®æ¸…ç©º
                    </button>
                  </div>

                  {error && (
                    <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded flex items-center">
                      <span className="mr-2">âš ï¸</span>
                      {error}
                    </div>
                  )}

                  {copyStatus && (
                    <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded flex items-center">
                      <span className="mr-2">âœ“</span>
                      {copyStatus}
                    </div>
                  )}
                </div>
              </div>
            </div>

            <div className="space-y-6">
              <div className="bg-gray-50 p-6 rounded-lg">
                <div className="mb-4">
                  <h2 className="text-xl font-semibold flex items-center mb-3">
                    <span className="mr-2">âœ“</span>
                    åˆ†æç»“æœ
                  </h2>
                  {results && (
                    <div className="flex gap-3 flex-wrap">
                      <button
                        onClick={() => handleCopy('english')}
                        className="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 flex items-center justify-center text-sm cursor-pointer min-w-[120px]"
                      >
                        <span className="mr-1">ğŸ“‹</span>
                        å¤åˆ¶è‹±æ–‡
                      </button>
                      <button
                        onClick={() => handleCopyEventOnly('english')}
                        className="border-2 border-blue-600 text-blue-600 bg-white py-2 px-4 rounded-md hover:bg-blue-50 flex items-center justify-center text-sm cursor-pointer min-w-[120px]"
                      >
                        <span className="mr-1">ğŸ“„</span>
                        èµ›äº‹ä¿¡æ¯ EN
                      </button>
                      <button
                        onClick={() => handleCopy('chinese')}
                        className="bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 flex items-center justify-center text-sm cursor-pointer min-w-[120px]"
                      >
                        <span className="mr-1">ğŸ“‹</span>
                        å¤åˆ¶ä¸­æ–‡
                      </button>
                      <button
                        onClick={() => handleCopyEventOnly('chinese')}
                        className="border-2 border-green-600 text-green-600 bg-white py-2 px-4 rounded-md hover:bg-green-50 flex items-center justify-center text-sm cursor-pointer min-w-[120px]"
                      >
                        <span className="mr-1">ğŸ“„</span>
                        èµ›äº‹ä¿¡æ¯ ä¸­æ–‡
                      </button>
                      <button
                        onClick={() => handleCopy('korean')}
                        className="bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 flex items-center justify-center text-sm cursor-pointer min-w-[120px]"
                      >
                        <span className="mr-1">ğŸ“‹</span>
                        å¤åˆ¶éŸ©æ–‡
                      </button>
                      <button
                        onClick={() => handleCopyEventOnly('korean')}
                        className="border-2 border-purple-600 text-purple-600 bg-white py-2 px-4 rounded-md hover:bg-purple-50 flex items-center justify-center text-sm cursor-pointer min-w-[120px]"
                      >
                        <span className="mr-1">ğŸ“„</span>
                        èµ›äº‹ä¿¡æ¯ í•œêµ­ì–´
                      </button>
                      <button
                        onClick={handleCopyTableData}
                        className="bg-amber-600 text-white py-2 px-4 rounded-md hover:bg-amber-700 flex items-center justify-center text-sm cursor-pointer min-w-[120px]"
                      >
                        <span className="mr-1">ğŸ“Š</span>
                        å¤åˆ¶è¡¨æ ¼æ•°æ®
                      </button>
                    </div>
                  )}
                </div>

                {results && results.eventCount > 1 && (
                  <div className="mb-4">
                    {!showPerEventReasons ? (
                      <div className="bg-blue-50 border border-blue-200 rounded-md p-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <div className="text-sm font-medium text-blue-900">
                              ğŸ“ æ£€æµ‹åˆ° {results.eventCount} åœºèµ›äº‹
                            </div>
                            <div className="text-xs text-blue-700 mt-1">
                              å½“å‰æ‰€æœ‰èµ›äº‹ä½¿ç”¨ç›¸åŒåŸå› 
                            </div>
                          </div>
                          <button
                            onClick={() => {
                              setShowPerEventReasons(true);
                              // Initialize per-event reasons with default
                              const initialReasons = {};
                              for (let i = 0; i < results.eventCount; i++) {
                                initialReasons[i] = analysisType === 'resettlement' ? resettlementReasonTemplate : cancellationReasonTemplate;
                              }
                              setPerEventReasons(initialReasons);
                            }}
                            className="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 flex items-center text-sm"
                          >
                            <span className="mr-1">ğŸ”§</span>
                            ä¸ºæ¯åœºèµ›äº‹å•ç‹¬è®¾ç½®åŸå› 
                          </button>
                        </div>
                      </div>
                    ) : (
                      <div className="bg-white border border-gray-300 rounded-md p-4">
                        <div className="flex items-center justify-between mb-3">
                          <div className="text-sm font-semibold text-gray-700">
                            ä¸ºæ¯åœºèµ›äº‹è®¾ç½®åŸå› 
                          </div>
                          <button
                            onClick={() => setShowPerEventReasons(false)}
                            className="text-gray-500 hover:text-gray-700 text-sm"
                          >
                            æ”¶èµ· â–²
                          </button>
                        </div>
                        <div className="space-y-3">
                          {results.analyzedData.map((item, index) => (
                            <div key={index} className="bg-gray-50 p-3 rounded border border-gray-200">
                              <div className="text-xs font-medium text-gray-600 mb-2">
                                Event {index + 1}: {item.eventName}
                              </div>
                              <select
                                value={perEventReasons[index] || ''}
                                onChange={(e) => setPerEventReasons({ ...perEventReasons, [index]: e.target.value })}
                                className="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                              >
                                {analysisType === 'resettlement' ? (
                                  <>
                                    <option value="">Will provide after confirming - ç¡®è®¤åæä¾› - í™•ì¸ í›„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤ (é¢„è®¾)</option>
                                    <option value="_custom_fill">âœï¸ è‡ªè¡Œå¡«å†™ (ç•™ç©º)</option>
                                    {Object.keys(resettlementReasonOptions).filter(k => k !== '' && k !== '_custom_fill').map(key => {
                                      const reason = resettlementReasonOptions[key];
                                      const isCustom = !defaultResettlementReasons[key];
                                      return (
                                        <option key={key} value={key}>
                                          {isCustom && 'â­ '}{reason.english} - {reason.chinese} - {reason.korean}
                                        </option>
                                      );
                                    })}
                                  </>
                                ) : (
                                  <>
                                    <option value="">Will provide after confirming - ç¡®è®¤åæä¾› - í™•ì¸ í›„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤ (é¢„è®¾)</option>
                                    <option value="_custom_fill">âœï¸ è‡ªè¡Œå¡«å†™ (ç•™ç©º)</option>
                                    {Object.keys(cancellationReasonOptions).filter(k => k !== '' && k !== '_custom_fill').map(key => {
                                      const reason = cancellationReasonOptions[key];
                                      const isCustom = !defaultCancellationReasons[key];
                                      return (
                                        <option key={key} value={key}>
                                          {isCustom && 'â­ '}{reason.english} - {reason.chinese} - {reason.korean}
                                        </option>
                                      );
                                    })}
                                  </>
                                )}
                              </select>
                            </div>
                          ))}
                        </div>
                        <button
                          onClick={handleRegenerateWithCustomReasons}
                          className="w-full mt-3 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 flex items-center justify-center"
                        >
                          <span className="mr-2">ğŸ”„</span>
                          é‡æ–°ç”ŸæˆæŠ¥å‘Š
                        </button>
                      </div>
                    )}
                  </div>
                )}

                {results ? (
                  <div className="space-y-4">
                    <div>
                      <h4 className="text-sm font-medium text-gray-600 mb-2">English</h4>
                      <div className="bg-white border border-gray-300 rounded-md p-3">
                        <pre className="whitespace-pre-wrap text-sm font-mono text-gray-800 max-h-32 overflow-y-auto">
                          {results.english}
                        </pre>
                      </div>
                    </div>

                    <div>
                      <h4 className="text-sm font-medium text-gray-600 mb-2">ä¸­æ–‡</h4>
                      <div className="bg-white border border-gray-300 rounded-md p-3">
                        <pre className="whitespace-pre-wrap text-sm font-mono text-gray-800 max-h-32 overflow-y-auto">
                          {results.chinese}
                        </pre>
                      </div>
                    </div>

                    <div>
                      <h4 className="text-sm font-medium text-gray-600 mb-2">í•œêµ­ì–´</h4>
                      <div className="bg-white border border-gray-300 rounded-md p-3">
                        <pre className="whitespace-pre-wrap text-sm font-mono text-gray-800 max-h-32 overflow-y-auto">
                          {results.korean}
                        </pre>
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="bg-white border border-gray-300 rounded-md p-4 text-center text-gray-500">
                    è¯·è¾“å…¥Seamless toolæ•°æ®å¹¶ç‚¹å‡»"å¼€å§‹åˆ†æ"æŸ¥çœ‹ç»“æœ
                  </div>
                )}
              </div>
            </div>
          </div>

          <div className="mt-8 bg-blue-50 p-6 rounded-lg">
            <h3 className="text-lg font-semibold mb-3">ä½¿ç”¨è¯´æ˜</h3>
            <div className="text-sm text-gray-700 space-y-2">
              <p><strong>æ•°æ®æ ¼å¼ï¼š</strong>ä»…æ”¯æŒSeamless toolçš„JSONæ•°ç»„æ ¼å¼æ•°æ®</p>
              <p><strong>é‡æ–°ç»“ç®—åˆ†æï¼š</strong>æ£€æµ‹åŒä¸€LineIDåœ¨å¤šæ¬¡ç»“ç®—ä¸­çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„è®°å½•</p>
              <p><strong>å–æ¶ˆåˆ†æï¼š</strong>è¯†åˆ«æœ€ç»ˆçŠ¶æ€ä¸º"Canceled"çš„æ¯”èµ›è®°å½•</p>
              <p><strong>å¤šè¯­è¨€è¾“å‡ºï¼š</strong>è‡ªåŠ¨ç”Ÿæˆè‹±æ–‡ã€ä¸­æ–‡ã€éŸ©æ–‡ä¸‰ç§ç‰ˆæœ¬çš„æŠ¥å‘Š</p>
              <p><strong>å¤åˆ¶åŠŸèƒ½ï¼š</strong>å¯åˆ†åˆ«å¤åˆ¶ä¸åŒè¯­è¨€ç‰ˆæœ¬çš„åˆ†æç»“æœ</p>
              <p><strong>çŠ¶æ€ç¿»è¯‘ï¼š</strong>ä¸­æ–‡å’ŒéŸ©æ–‡ç‰ˆæœ¬ä¼šè‡ªåŠ¨ç¿»è¯‘çŠ¶æ€æ–‡æœ¬</p>
              <p><strong>åŸå› é€‰æ‹©ï¼š</strong>å¯é€‰æ‹©é¢„è®¾åŸå› æˆ–è‡ªå®šä¹‰åŸå› ï¼Œé»˜è®¤ä¸º"ç¡®è®¤åæä¾›"</p>
              <p><strong>âš™ï¸ è‡ªå®šä¹‰åŸå› ï¼š</strong>ç‚¹å‡»å³ä¸Šè§’é½¿è½®æŒ‰é’®ï¼Œé€‰æ‹©åŸå› ç±»å‹ï¼ˆé‡æ–°ç»“ç®—/å–æ¶ˆï¼‰ï¼Œå¡«å†™ä¸‰ç§è¯­è¨€çš„åŸå› å³å¯æ·»åŠ ï¼Œè‹±æ–‡è‡ªåŠ¨é¦–å­—æ¯å¤§å†™ï¼Œå¸¦â­æ ‡è®°ï¼Œæ•°æ®è‡ªåŠ¨ä¿å­˜</p>
            </div>
          </div>
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BettingSettlementAnalyzer />);
  </script>
</body>
</html>

